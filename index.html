<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WZH4WD98Y9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WZH4WD98Y9');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>빅데이터 분석기사 핵심 문제집</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;900&display=swap');
        
        html, body {
            overscroll-behavior: none;
            height: 100%;
            overflow: hidden;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            touch-action: pan-y;
            height: 100dvh; 
        }
        
        main {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .question-enter {
            opacity: 0;
            transform: scale(0.95) translateY(20px);
        }
        
        .question-enter-active {
            opacity: 1;
            transform: scale(1) translateY(0);
            transition: all 300ms ease-out;
        }
        
        .option {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid #e5e7eb;
        }
        
        .option:hover {
            border-color: #06b6d4;
            background-color: #f0f9ff;
        }
        
        .option.correct {
            background-color: #dcfce7;
            border-color: #16a34a;
            color: #166534;
        }
        
        .option.incorrect {
            background-color: #fef2f2;
            border-color: #dc2626;
            color: #991b1b;
        }
        
        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .difficulty-star {
            color: #fbbf24;
            font-size: 1.2rem;
        }
        
        .modal-enter {
            opacity: 0;
        }
        
        .modal-enter .modal-content {
            transform: scale(0.9);
        }
        
        .modal-enter-active {
            opacity: 1;
            transition: opacity 200ms ease-in-out;
        }
        
        .modal-enter-active .modal-content {
            transform: scale(1);
            transition: transform 200ms ease-in-out;
        }
        
        header, footer {
            transition: transform 0.3s ease-in-out;
        }
        
        header {
            transform: translateY(-120%);
        }
        
        header.is-visible {
            transform: translateY(0);
        }
        
        footer {
            transform: translateY(120%);
        }
        
        footer.is-visible {
            transform: translateY(0);
        }
        
        .wrong-count-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .nav-button {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        #question-container-wrapper:hover .nav-button {
            opacity: 0.5;
        }
        
        .nav-button:hover {
            opacity: 1 !important;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .progress-ring {
            transition: stroke-dasharray 0.3s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 text-stone-800 w-screen overflow-hidden">

    <!-- Header -->
    <header id="app-header" class="p-4 shadow-lg bg-white/90 backdrop-blur-sm w-full z-40 fixed top-0 left-0">
        <div class="max-w-6xl mx-auto">
            <div class="flex items-center justify-between mb-3">
                <h1 class="text-xl md:text-2xl font-bold text-cyan-600">빅데이터 분석기사 문제집</h1>
                <div class="flex items-center gap-3">
                    <button id="wrong-notes-btn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-full text-sm font-medium transition-colors">
                        오답노트 <span id="wrong-count" class="bg-white text-red-500 rounded-full px-2 py-0.5 ml-1 text-xs font-bold">0</span>
                    </button>
                    <button id="reset-progress-btn" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded-full text-sm font-medium transition-colors">
                        진도 초기화
                    </button>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span id="progress-text" class="text-sm font-semibold text-stone-600 w-24 text-center">1 / 10</span>
                <div class="flex-1 bg-stone-200 rounded-full h-3">
                    <div id="progress-bar" class="bg-gradient-to-r from-cyan-500 to-blue-500 h-3 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
                <div class="relative w-12 h-12">
                    <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                        <path class="text-gray-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                        <path id="progress-ring" class="text-cyan-500 progress-ring" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span id="progress-percentage" class="text-xs font-bold text-cyan-600">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="w-full h-full px-4 py-8 relative flex justify-center overflow-y-auto">
        <div id="question-container-wrapper" class="w-full max-w-5xl flex items-center justify-center relative">
            <!-- Prev Button -->
            <button id="prev-btn" class="nav-button absolute left-0 top-1/2 -translate-y-1/2 z-20 p-4 rounded-full hidden md:block">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>

            <!-- Question Container -->
            <div id="question-container" class="w-full h-full flex items-center justify-center">
                <!-- Question will be inserted here by JS -->
            </div>

            <!-- Next Button -->
            <button id="next-btn" class="nav-button absolute right-0 top-1/2 -translate-y-1/2 z-20 p-4 rounded-full hidden md:block">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
    </main>
    
    <!-- UI Toggle Buttons -->
    <button id="header-toggle-btn" class="fixed top-4 right-4 z-50 bg-black/30 text-white rounded-full p-2 hover:bg-black/50 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
        </svg>
    </button>
    <button id="footer-toggle-btn" class="fixed bottom-4 right-4 z-50 bg-black/30 text-white rounded-full p-2 hover:bg-black/50 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
        </svg>
    </button>

    <!-- Footer -->
    <footer id="app-footer" class="p-4 bg-white/80 backdrop-blur-sm w-full z-40 fixed bottom-0 left-0">
        <div class="flex justify-center items-center gap-4 flex-wrap">
            <button id="shuffle-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-full transition-colors">문제 섞기</button>
            <button id="restart-btn" class="bg-stone-500 hover:bg-stone-600 text-white font-bold py-2 px-4 rounded-full transition-colors">처음으로</button>
            <button id="show-all-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-full transition-colors">전체보기</button>
            <button id="filter-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-full transition-colors">난이도별</button>
        </div>
        <p class="text-center text-xs text-stone-500 mt-3">좌우 스와이프 또는 화면 좌우 클릭으로 문제를 넘길 수 있습니다.</p>
    </footer>

    <!-- Wrong Notes Modal -->
    <div id="wrong-notes-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-5 border-b border-stone-200">
                <h2 class="text-xl font-bold text-red-600">오답노트</h2>
                <button id="wrong-notes-close-btn" class="text-stone-400 hover:text-stone-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="wrong-notes-content" class="p-6 overflow-y-auto flex-1">
                <p class="text-center text-stone-500 py-8">틀린 문제가 없습니다! 🎉</p>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="filter-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-md flex flex-col">
            <div class="flex justify-between items-center p-5 border-b border-stone-200">
                <h2 class="text-xl font-bold text-purple-600">난이도별 필터</h2>
                <button id="filter-close-btn" class="text-stone-400 hover:text-stone-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-stone-200 hover:border-purple-400 hover:bg-purple-50 transition-colors" data-difficulty="0">
                        전체 문제
                    </button>
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-stone-200 hover:border-purple-400 hover:bg-purple-50 transition-colors" data-difficulty="1">
                        <span class="difficulty-star">★</span> 쉬움
                    </button>
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-stone-200 hover:border-purple-400 hover:bg-purple-50 transition-colors" data-difficulty="2">
                        <span class="difficulty-star">★★</span> 보통
                    </button>
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-stone-200 hover:border-purple-400 hover:bg-purple-50 transition-colors" data-difficulty="3">
                        <span class="difficulty-star">★★★</span> 어려움
                    </button>
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-stone-200 hover:border-purple-400 hover:bg-purple-50 transition-colors" data-difficulty="4">
                        <span class="difficulty-star">★★★★</span> 매우 어려움
                    </button>
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-stone-200 hover:border-purple-400 hover:bg-purple-50 transition-colors" data-difficulty="5">
                        <span class="difficulty-star">★★★★★</span> 최고 난이도
                    </button>
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-red-200 bg-red-50 hover:border-red-400 hover:bg-red-100 transition-colors" data-difficulty="official">
                        <span class="text-red-600 font-bold text-lg">🔥 기출문제</span> - 실제 시험 출제 문제
                    </button>
                    <button class="filter-option w-full text-left p-3 rounded-lg border-2 border-red-200 bg-red-50 hover:border-red-400 hover:bg-red-100 transition-colors" data-difficulty="-1">
                        <span class="text-red-600 font-bold">📝 오답노트</span> - 틀린 문제만
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 데이터 로딩 함수
        async function loadQuestions() {
            try {
                const response = await fetch('questions.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const questions = await response.json();
                console.log(`데이터 로딩 성공: ${questions.length}개 문제`);
                console.log('데이터 구조 샘플:', questions[0]);
                return questions;
            } catch (error) {
                console.error('문제 데이터를 로드할 수 없습니다:', error);
                // 기본 에러 메시지 표시
                document.body.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                        <div class="text-center p-8">
                            <h1 class="text-2xl font-bold text-red-600 mb-4">데이터 로딩 오류</h1>
                            <p class="text-gray-700">문제 데이터를 불러올 수 없습니다.</p>
                            <p class="text-gray-600 text-sm mt-2">questions.json 파일이 존재하는지 확인해주세요.</p>
                        </div>
                    </div>
                `;
                return [];
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // --- DATA LOADING ---
            const questions = await loadQuestions();
            if (questions.length === 0) {
                return; // 데이터 로딩 실패시 종료
            }

            // --- STATE ---
            let currentQuestionIndex = 0;
            let questionOrder = [...Array(questions.length).keys()];
            let isAnswered = false;
            let selectedOption = -1;
            let wrongAnswers = JSON.parse(localStorage.getItem('wrongAnswers') || '{}');
            let wrongCounts = JSON.parse(localStorage.getItem('wrongCounts') || '{}');
            let currentFilter = 0; // 0: 전체, 1-5: 난이도별
            let filteredQuestions = [...questionOrder];

            // --- DOM ELEMENTS ---
            const questionContainer = document.getElementById('question-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressRing = document.getElementById('progress-ring');
            const progressPercentage = document.getElementById('progress-percentage');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const shuffleBtn = document.getElementById('shuffle-btn');
            const restartBtn = document.getElementById('restart-btn');
            const wrongNotesBtn = document.getElementById('wrong-notes-btn');
            const wrongCount = document.getElementById('wrong-count');
            const resetProgressBtn = document.getElementById('reset-progress-btn');
            const filterBtn = document.getElementById('filter-btn');
            
            // Modals
            const wrongNotesModal = document.getElementById('wrong-notes-modal');
            const wrongNotesContent = document.getElementById('wrong-notes-content');
            const wrongNotesCloseBtn = document.getElementById('wrong-notes-close-btn');
            const filterModal = document.getElementById('filter-modal');
            const filterCloseBtn = document.getElementById('filter-close-btn');
            
            // UI Toggle
            const headerToggleBtn = document.getElementById('header-toggle-btn');
            const footerToggleBtn = document.getElementById('footer-toggle-btn');
            const appHeader = document.getElementById('app-header');
            const appFooter = document.getElementById('app-footer');

            // --- HELPER FUNCTIONS ---
            const saveProgress = () => {
                localStorage.setItem('currentQuestionIndex', currentQuestionIndex.toString());
                localStorage.setItem('wrongAnswers', JSON.stringify(wrongAnswers));
                localStorage.setItem('wrongCounts', JSON.stringify(wrongCounts));
            };

            const loadProgress = () => {
                const savedIndex = localStorage.getItem('currentQuestionIndex');
                if (savedIndex !== null) {
                    currentQuestionIndex = parseInt(savedIndex, 10);
                }
                updateWrongCount();
            };

            const updateWrongCount = () => {
                const wrongCount = Object.keys(wrongAnswers).length;
                document.getElementById('wrong-count').textContent = wrongCount.toString();
            };

            const updateProgress = () => {
                const progress = ((currentQuestionIndex + 1) / filteredQuestions.length) * 100;
                const totalQuestions = filteredQuestions.length;
                const currentNumber = currentQuestionIndex + 1;
                
                progressBar.style.width = progress + '%';
                progressText.textContent = `${currentNumber} / ${totalQuestions}`;
                
                // 원형 진행률 업데이트
                const circumference = 2 * Math.PI * 15.9155;
                const strokeDasharray = (progress / 100) * circumference;
                progressRing.style.strokeDasharray = `${strokeDasharray}, ${circumference}`;
                progressPercentage.textContent = Math.round(progress) + '%';
            };

            const getDifficultyStars = (difficulty) => {
                return '★'.repeat(difficulty);
            };

            const renderQuestion = () => {
                if (filteredQuestions.length === 0) {
                    questionContainer.innerHTML = '<div class="text-center p-8"><h2 class="text-2xl font-bold text-stone-600">해당 난이도의 문제가 없습니다</h2></div>';
                    return;
                }

                const questionData = questions[filteredQuestions[currentQuestionIndex]];
                const questionId = filteredQuestions[currentQuestionIndex];
                const wrongCountForQuestion = wrongCounts[questionId] || 0;

                questionContainer.innerHTML = '';
                
                const questionElement = document.createElement('div');
                questionElement.className = 'w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8 question-enter';
                
                questionElement.innerHTML = `
                    <div class="mb-6">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl font-bold text-cyan-600">Q${currentQuestionIndex + 1}</span>
                                <span class="difficulty-star text-xl">${getDifficultyStars(questionData.difficulty_level)}</span>
                                ${questionData.type === "기출문제" ? `<span class="official-badge bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg border-2 border-red-400 animate-pulse">🔥 기출문제</span>` : ''}
                                ${questionData.year ? `<span class="year-badge bg-blue-500 text-white px-2 py-1 rounded text-xs">${questionData.year}년 ${questionData.round}회</span>` : ''}
                            </div>
                            ${wrongCountForQuestion > 0 ? `<div class="wrong-count-badge">틀린 횟수: ${wrongCountForQuestion}</div>` : ''}
                        </div>
                        <h2 class="text-xl md:text-2xl font-bold leading-relaxed text-stone-800">${questionData.question}</h2>
                    </div>
                    <div class="space-y-3" id="options-container">
                        ${questionData.options.map((option, index) => `
                            <button class="option w-full p-4 text-left rounded-xl text-lg font-medium hover:shadow-md transition-all" 
                                    data-option="${index}">
                                <span class="font-bold mr-3">${['①', '②', '③', '④'][index]}</span>
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                    <div id="explanation" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-xl hidden">
                        <h3 class="font-bold text-blue-800 mb-2">설명</h3>
                        <p class="text-blue-700 leading-relaxed">${questionData.explanation}</p>
                    </div>
                `;

                questionContainer.appendChild(questionElement);

                // 애니메이션 트리거
                requestAnimationFrame(() => {
                    questionElement.classList.add('question-enter-active');
                });

                // 옵션 클릭 이벤트 추가
                const optionButtons = questionElement.querySelectorAll('.option');
                optionButtons.forEach(button => {
                    button.addEventListener('click', handleOptionClick);
                });

                isAnswered = false;
                selectedOption = -1;
                updateProgress();
            };

            const handleOptionClick = (event) => {
                if (isAnswered) return;

                const clickedOption = parseInt(event.currentTarget.dataset.option);
                const questionData = questions[filteredQuestions[currentQuestionIndex]];
                const questionId = filteredQuestions[currentQuestionIndex];
                const optionButtons = document.querySelectorAll('.option');

                selectedOption = clickedOption;
                isAnswered = true;

                // 모든 옵션 비활성화
                optionButtons.forEach(button => {
                    button.classList.add('disabled');
                });

                // 정답/오답 표시
                optionButtons.forEach((button, index) => {
                    if (index === questionData.correct) {
                        button.classList.add('correct');
                    } else if (index === clickedOption && index !== questionData.correct) {
                        button.classList.add('incorrect');
                    }
                });

                // 오답 처리
                if (clickedOption !== questionData.correct) {
                    wrongAnswers[questionId] = {
                        question: questionData.question,
                        options: questionData.options,
                        userAnswer: clickedOption,
                        correctAnswer: questionData.correct,
                        explanation: questionData.explanation,
                        difficulty: questionData.difficulty_level
                    };
                    
                    wrongCounts[questionId] = (wrongCounts[questionId] || 0) + 1;
                } else {
                    // 정답을 맞춘 경우 오답노트에서 제거
                    if (wrongAnswers[questionId]) {
                        delete wrongAnswers[questionId];
                    }
                }

                // 설명 표시
                document.getElementById('explanation').classList.remove('hidden');

                saveProgress();
                updateWrongCount();

                // 자동 이동 기능 제거됨
            };

            const navigate = (direction) => {
                const newIndex = currentQuestionIndex + direction;
                if (newIndex >= 0 && newIndex < filteredQuestions.length) {
                    currentQuestionIndex = newIndex;
                    renderQuestion();
                }
            };

            const shuffleQuestions = () => {
                for (let i = filteredQuestions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [filteredQuestions[i], filteredQuestions[j]] = [filteredQuestions[j], filteredQuestions[i]];
                }
                currentQuestionIndex = 0;
                renderQuestion();
            };

            const restart = () => {
                currentQuestionIndex = 0;
                renderQuestion();
            };

            const resetProgress = () => {
                if (confirm('모든 진행상황과 오답 데이터가 초기화됩니다. 계속하시겠습니까?')) {
                    localStorage.removeItem('currentQuestionIndex');
                    localStorage.removeItem('wrongAnswers');
                    localStorage.removeItem('wrongCounts');
                    wrongAnswers = {};
                    wrongCounts = {};
                    currentQuestionIndex = 0;
                    updateWrongCount();
                    renderQuestion();
                }
            };

            const showWrongNotes = () => {
                const wrongIds = Object.keys(wrongAnswers);
                
                if (wrongIds.length === 0) {
                    wrongNotesContent.innerHTML = '<p class="text-center text-stone-500 py-8">틀린 문제가 없습니다! 🎉</p>';
                } else {
                    wrongNotesContent.innerHTML = wrongIds.map(id => {
                        const wrong = wrongAnswers[id];
                        const wrongCountForQuestion = wrongCounts[id] || 0;
                        
                        return `
                            <div class="border border-stone-200 rounded-xl p-6 mb-4 bg-red-50">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex items-center gap-3">
                                        <span class="text-lg font-bold text-red-600">Q${parseInt(id) + 1}</span>
                                        <span class="difficulty-star">${getDifficultyStars(wrong.difficulty)}</span>
                                    </div>
                                    <div class="wrong-count-badge">틀린 횟수: ${wrongCountForQuestion}</div>
                                </div>
                                <h3 class="font-bold text-stone-800 mb-3">${wrong.question}</h3>
                                <div class="space-y-2 mb-4">
                                    ${wrong.options.map((option, index) => `
                                        <div class="p-2 rounded ${index === wrong.correctAnswer ? 'bg-green-100 border border-green-300' : 
                                        (index === wrong.userAnswer ? 'bg-red-100 border border-red-300' : 'bg-white border border-stone-200')}">
                                            <span class="font-medium mr-2">${['①', '②', '③', '④'][index]}</span>
                                            ${option}
                                            ${index === wrong.correctAnswer ? '<span class="text-green-600 font-bold ml-2">✓ 정답</span>' : ''}
                                            ${index === wrong.userAnswer && index !== wrong.correctAnswer ? '<span class="text-red-600 font-bold ml-2">✗ 선택</span>' : ''}
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                                    <h4 class="font-bold text-blue-800 mb-2">설명</h4>
                                    <p class="text-blue-700">${wrong.explanation}</p>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                wrongNotesModal.classList.remove('hidden');
                wrongNotesModal.classList.add('modal-enter');
                requestAnimationFrame(() => {
                    wrongNotesModal.classList.add('modal-enter-active');
                });
            };

            const hideWrongNotes = () => {
                wrongNotesModal.classList.remove('modal-enter-active');
                wrongNotesModal.classList.remove('modal-enter');
                setTimeout(() => {
                    wrongNotesModal.classList.add('hidden');
                }, 200);
            };

            const applyFilter = (difficulty) => {
                currentFilter = difficulty;
                if (difficulty === 0) {
                    filteredQuestions = [...questionOrder];
                } else if (difficulty === -1) {
                    // 오답노트 필터
                    const wrongIds = Object.keys(wrongAnswers).map(id => parseInt(id));
                    filteredQuestions = questionOrder.filter(index => wrongIds.includes(index));
                    if (filteredQuestions.length === 0) {
                        alert('틀린 문제가 없습니다! 🎉');
                        filteredQuestions = [...questionOrder];
                        currentFilter = 0;
                    }
                } else if (difficulty === 'official') {
                    // 기출문제 필터
                    filteredQuestions = questionOrder.filter(index => questions[index].type === "기출문제");
                    if (filteredQuestions.length === 0) {
                        alert('기출문제가 없습니다!');
                        filteredQuestions = [...questionOrder];
                        currentFilter = 0;
                    }
                } else {
                    filteredQuestions = questionOrder.filter(index => questions[index].difficulty_level === difficulty);
                }
                currentQuestionIndex = 0;
                renderQuestion();
            };

            const showFilterModal = () => {
                filterModal.classList.remove('hidden');
                filterModal.classList.add('modal-enter');
                requestAnimationFrame(() => {
                    filterModal.classList.add('modal-enter-active');
                });
            };

            const hideFilterModal = () => {
                filterModal.classList.remove('modal-enter-active');
                filterModal.classList.remove('modal-enter');
                setTimeout(() => {
                    filterModal.classList.add('hidden');
                }, 200);
            };

            // --- EVENT LISTENERS ---
            prevBtn.addEventListener('click', () => navigate(-1));
            nextBtn.addEventListener('click', () => navigate(1));
            shuffleBtn.addEventListener('click', shuffleQuestions);
            restartBtn.addEventListener('click', restart);
            wrongNotesBtn.addEventListener('click', () => {
                // 오답노트를 필터로 적용
                applyFilter(-1);
            });
            resetProgressBtn.addEventListener('click', resetProgress);
            filterBtn.addEventListener('click', showFilterModal);

            // Modal event listeners
            wrongNotesCloseBtn.addEventListener('click', hideWrongNotes);
            wrongNotesModal.addEventListener('click', (e) => {
                if (e.target === wrongNotesModal) hideWrongNotes();
            });

            filterCloseBtn.addEventListener('click', hideFilterModal);
            filterModal.addEventListener('click', (e) => {
                if (e.target === filterModal) hideFilterModal();
            });

            // Filter options
            document.querySelectorAll('.filter-option').forEach(option => {
                option.addEventListener('click', () => {
                    const difficultyValue = option.dataset.difficulty;
                    let difficulty;
                    
                    if (difficultyValue === 'official') {
                        difficulty = 'official';
                    } else {
                        difficulty = parseInt(difficultyValue);
                    }
                    
                    applyFilter(difficulty);
                    hideFilterModal();
                });
            });

            // UI Toggle Listeners
            headerToggleBtn.addEventListener('click', () => appHeader.classList.toggle('is-visible'));
            footerToggleBtn.addEventListener('click', () => appFooter.classList.toggle('is-visible'));

            // Swipe navigation
            let touchStartX = 0;
            let touchEndX = 0;
            const swipeThreshold = 50;

            questionContainer.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            questionContainer.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });

            const handleSwipe = () => {
                const swipeDistance = touchEndX - touchStartX;
                if (Math.abs(swipeDistance) > swipeThreshold) {
                    if (swipeDistance < 0) {
                        navigate(1); // Swipe left - next
                    } else {
                        navigate(-1); // Swipe right - prev
                    }
                }
            };

            // Click navigation - 전체 화면 영역으로 확대
            document.body.addEventListener('click', (e) => {
                // 옵션 버튼, 설명 영역, 버튼들을 클릭한 경우는 제외
                if (e.target.closest('.option') || 
                    e.target.closest('#explanation') || 
                    e.target.closest('button') ||
                    e.target.closest('header') ||
                    e.target.closest('footer') ||
                    e.target.closest('.modal-content')) {
                    return;
                }
                
                // 전체 화면의 좌우 영역 클릭으로 이동
                const clickX = e.clientX;
                const screenWidth = window.innerWidth;
                
                if (clickX < screenWidth / 2) {
                    navigate(-1); // 왼쪽 절반 클릭 - 이전 문제
                } else {
                    navigate(1); // 오른쪽 절반 클릭 - 다음 문제
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    navigate(-1);
                } else if (e.key === 'ArrowRight') {
                    navigate(1);
                } else if (e.key >= '1' && e.key <= '4' && !isAnswered) {
                    const optionIndex = parseInt(e.key) - 1;
                    const optionButton = document.querySelector(`.option[data-option="${optionIndex}"]`);
                    if (optionButton) {
                        optionButton.click();
                    }
                }
            });

            // --- INITIAL LOAD ---
            loadProgress();
            renderQuestion();
        });
    </script>
</body>
</html>